

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Stheno &mdash; stheno 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Application Programming Interface" href="api.html" />
    <link rel="prev" title="Welcome" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> stheno
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stheno</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#nonlinear-regression-in-20-seconds">Nonlinear Regression in 20 Seconds</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manual">Manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#autograd-tensorflow-pytorch-or-jax-your-choice">AutoGrad, TensorFlow, PyTorch, or JAX? Your Choice!</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-design">Model Design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#compositional-design">Compositional Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="#displaying-gps">Displaying GPs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#properties-of-gps">Properties of GPs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#naming-gps">Naming GPs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#finite-dimensional-distributions">Finite-Dimensional Distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#prior-and-posterior-measures">Prior and Posterior Measures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inducing-points">Inducing Points</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kernels-and-means">Kernels and Means</a></li>
<li class="toctree-l3"><a class="reference internal" href="#important-remarks">Important Remarks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simple-regression">Simple Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decomposition-of-prediction">Decomposition of Prediction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#learn-a-function-incorporating-prior-knowledge-about-its-form">Learn a Function, Incorporating Prior Knowledge About Its Form</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multi-output-regression">Multi-Output Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#approximate-integration">Approximate Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bayesian-linear-regression">Bayesian Linear Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gpar">GPAR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-gp-rnn-model">A GP-RNN Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#approximate-multiplication-between-gps">Approximate Multiplication Between GPs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sparse-regression">Sparse Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#smoothing-with-nonparametric-basis-functions">Smoothing with Nonparametric Basis Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Application Programming Interface</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">stheno</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Stheno</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/readme.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="stheno">
<h1><a class="reference external" href="https://github.com/wesselb/stheno">Stheno</a><a class="headerlink" href="#stheno" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://github.com/wesselb/stheno/actions?query=workflow%3ACI"><img alt="CI" src="https://github.com/wesselb/stheno/workflows/CI/badge.svg?branch=master" /></a> <a class="reference external" href="https://coveralls.io/github/wesselb/stheno?branch=master"><img alt="Coverage Status" src="https://coveralls.io/repos/github/wesselb/stheno/badge.svg?branch=master" /></a> <a class="reference external" href="https://wesselb.github.io/stheno"><img alt="Latest Docs" src="https://img.shields.io/badge/docs-latest-blue.svg" /></a> <a class="reference external" href="https://github.com/psf/black"><img alt="Code style: black" src="https://img.shields.io/badge/code%20style-black-000000.svg" /></a></p>
<p>Stheno is an implementation of Gaussian process modelling in Python. See
also <a class="reference external" href="https://github.com/willtebbutt/Stheno.jl">Stheno.jl</a>.</p>
<p><a class="reference external" href="https://wesselb.github.io/2021/01/19/linear-models-with-stheno-and-jax.html">Check out our post about linear models with Stheno and
JAX.</a></p>
<p>Contents:</p>
<ul class="simple">
<li><p><a class="reference external" href="#nonlinear-regression-in-20-seconds">Nonlinear Regression in 20
Seconds</a></p></li>
<li><p><a class="reference external" href="#installation">Installation</a></p></li>
<li><p><a class="reference external" href="#manual">Manual</a></p>
<ul>
<li><p><a class="reference external" href="#autograd-tensorflow-pytorch-or-jax-your-choice">AutoGrad, TensorFlow, PyTorch, or JAX? Your
Choice!</a></p></li>
<li><p><a class="reference external" href="#model-design">Model Design</a></p></li>
<li><p><a class="reference external" href="#finite-dimensional-distributions">Finite-Dimensional
Distributions</a></p></li>
<li><p><a class="reference external" href="#prior-and-posterior-measures">Prior and Posterior Measures</a></p></li>
<li><p><a class="reference external" href="#inducing-points">Inducing Points</a></p></li>
<li><p><a class="reference external" href="#kernels-and-means">Kernels and Means</a></p></li>
<li><p><a class="reference external" href="#important-remarks">Important Remarks</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#examples">Examples</a></p>
<ul>
<li><p><a class="reference external" href="#simple-regression">Simple Regression</a></p></li>
<li><p><a class="reference external" href="#decomposition-of-prediction">Decomposition of Prediction</a></p></li>
<li><p><a class="reference external" href="#learn-a-function-incorporating-prior-knowledge-about-its-form">Learn a Function, Incorporating Prior Knowledge About Its
Form</a></p></li>
<li><p><a class="reference external" href="#multi-output-regression">Multi-Output Regression</a></p></li>
<li><p><a class="reference external" href="#approximate-integration">Approximate Integration</a></p></li>
<li><p><a class="reference external" href="#bayesian-linear-regression">Bayesian Linear Regression</a></p></li>
<li><p><a class="reference external" href="#gpar">GPAR</a></p></li>
<li><p><a class="reference external" href="#a-gp-rnn-model">A GP-RNN Model</a></p></li>
<li><p><a class="reference external" href="#approximate-multiplication-between-gps">Approximate Multiplication Between
GPs</a></p></li>
<li><p><a class="reference external" href="#sparse-regression">Sparse Regression</a></p></li>
<li><p><a class="reference external" href="#smoothing-with-nonparametric-basis-functions">Smoothing with Nonparametric Basis
Functions</a></p></li>
</ul>
</li>
</ul>
<p><strong>Breaking change:</strong> <code class="docutils literal notranslate"><span class="pre">f(x).marginals()</span></code> now returns the marginals
means and variances, rather than the marginal means and lower and upper
95% central credible region bounds. For the credible bounds, use
<code class="docutils literal notranslate"><span class="pre">f(x).marginal_credible_bounds()</span></code> instead.</p>
<div class="section" id="nonlinear-regression-in-20-seconds">
<h2>Nonlinear Regression in 20 Seconds<a class="headerlink" href="#nonlinear-regression-in-20-seconds" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>         <span class="c1"># Some points to predict at</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>                        <span class="c1"># Some observations</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span>                      <span class="c1"># Construct Gaussian process.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_post</span> <span class="o">=</span> <span class="n">f</span> <span class="o">|</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>            <span class="c1"># Compute the posterior.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_post</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span> <span class="c1"># Predict!</span>
<span class="go">&lt;dense matrix: shape=3x1, dtype=float64</span>
<span class="go"> mat=[[1.   ]</span>
<span class="go">      [4.   ]</span>
<span class="go">      [8.483]]&gt;</span>
</pre></div>
</div>
<p>Moar?! Then read on!</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference external" href="https://gist.github.com/wesselb/4b44bf87f3789425f96e26c4308d0adc">the instructions
here</a>.
Then simply</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">stheno</span>
</pre></div>
</div>
</div>
<div class="section" id="manual">
<h2>Manual<a class="headerlink" href="#manual" title="Permalink to this headline">¶</a></h2>
<p>Note: <a class="reference external" href="https://wesselb.github.io/stheno">here</a> is a nicely rendered
and more readable version of the docs.</p>
<div class="section" id="autograd-tensorflow-pytorch-or-jax-your-choice">
<h3>AutoGrad, TensorFlow, PyTorch, or JAX? Your Choice!<a class="headerlink" href="#autograd-tensorflow-pytorch-or-jax-your-choice" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stheno.autograd</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stheno.tensorflow</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stheno.torch</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stheno.jax</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>
</pre></div>
</div>
</div>
<div class="section" id="model-design">
<h3>Model Design<a class="headerlink" href="#model-design" title="Permalink to this headline">¶</a></h3>
<p>The basic building block is a <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">GP(mean=0,</span> <span class="pre">kernel,</span> <span class="pre">measure=prior)</span></code>,
which takes in <a class="reference external" href="#kernels-and-means">a *mean*, a *kernel*</a>, and a
<em>measure</em>. The mean and kernel of a GP can be extracted with <code class="docutils literal notranslate"><span class="pre">f.mean</span></code>
and <code class="docutils literal notranslate"><span class="pre">f.kernel</span></code>. The measure should be thought of as a big joint
distribution that assigns a mean and a kernel to every variable <code class="docutils literal notranslate"><span class="pre">f</span></code>. A
measure can be created with <code class="docutils literal notranslate"><span class="pre">prior</span> <span class="pre">=</span> <span class="pre">Measure()</span></code>. A GP <code class="docutils literal notranslate"><span class="pre">f</span></code> can have
different means and kernels under different measures. For example, under
some <em>prior</em> measure, <code class="docutils literal notranslate"><span class="pre">f</span></code> can have an <code class="docutils literal notranslate"><span class="pre">EQ()</span></code> kernel; but, under some
<em>posterior</em> measure, <code class="docutils literal notranslate"><span class="pre">f</span></code> has a kernel that is determined by the
posterior distribution of a GP. <a class="reference external" href="#prior-and-posterior-measures">We will see later how posterior
measures can be constructed.</a> The
measure with which a <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">GP(kernel,</span> <span class="pre">measure=prior)</span></code> is constructed
can be extracted with <code class="docutils literal notranslate"><span class="pre">f.measure</span> <span class="pre">==</span> <span class="pre">prior</span></code>. If the keyword argument
<code class="docutils literal notranslate"><span class="pre">measure</span></code> is not set, then automatically a new measure is created,
which afterwards can be extracted with <code class="docutils literal notranslate"><span class="pre">f.measure</span></code>.</p>
<p>Definition, where <code class="docutils literal notranslate"><span class="pre">prior</span> <span class="pre">=</span> <span class="pre">Measure()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">kernel</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
</pre></div>
</div>
<p>GPs that are associated to the same measure can be combined into new
GPs, which is the primary mechanism used to build cool models.</p>
<p>Here’s an example model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prior</span> <span class="o">=</span> <span class="n">Measure</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f1</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">EQ</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f1</span>
<span class="go">GP(&lt;lambda&gt;, EQ())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f2</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">Linear</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f2</span>
<span class="go">GP(0, Linear())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_sum</span> <span class="o">=</span> <span class="n">f1</span> <span class="o">+</span> <span class="n">f2</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_sum</span>
<span class="go">GP(&lt;lambda&gt;, EQ() + Linear())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_sum</span> <span class="o">+</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span>  <span class="c1"># Not valid: `GP(EQ())` belongs to a new measure!</span>
<span class="go">AssertionError: Processes GP(&lt;lambda&gt;, EQ() + Linear()) and GP(0, EQ()) are associated to different measures.</span>
</pre></div>
</div>
<p>To avoid setting the keyword <code class="docutils literal notranslate"><span class="pre">measure</span></code> for every <code class="docutils literal notranslate"><span class="pre">GP</span></code> that you
create, you can enter a measure as a context:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">Measure</span><span class="p">()</span> <span class="k">as</span> <span class="n">prior</span><span class="p">:</span>
<span class="go">        f1 = GP(lambda x: x ** 2, EQ())</span>
<span class="go">        f2 = GP(Linear())</span>
<span class="go">        f_sum = f1 + f2</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">prior</span> <span class="o">==</span> <span class="n">f1</span><span class="o">.</span><span class="n">measure</span> <span class="o">==</span> <span class="n">f2</span><span class="o">.</span><span class="n">measure</span> <span class="o">==</span> <span class="n">f_sum</span><span class="o">.</span><span class="n">measure</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="section" id="compositional-design">
<h4>Compositional Design<a class="headerlink" href="#compositional-design" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>Add and subtract GPs and other objects.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span> <span class="o">+</span> <span class="n">GP</span><span class="p">(</span><span class="n">Exp</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
<span class="go">GP(0, EQ() + Exp())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span> <span class="o">+</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
<span class="go">GP(0, 2 * EQ())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span>
<span class="go">GP(1, EQ())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span> <span class="o">+</span> <span class="mi">0</span>
<span class="go">GP(0, EQ())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span> <span class="o">+</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">GP(&lt;lambda&gt;, EQ())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">EQ</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span> <span class="o">-</span> <span class="n">GP</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">EQ</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
<span class="go">GP(1, 2 * EQ())</span>
</pre></div>
</div>
</li>
<li><p>Multiply GPs and other objects.</p>
<p><em>Warning:</em> The product of two GPs it <em>not</em> a Gaussian process. Stheno
approximates the resulting process by moment matching.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">EQ</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Exp</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>
<span class="go">GP(&lt;lambda&gt; + &lt;lambda&gt; + -1 * 1, &lt;lambda&gt; * Exp() + &lt;lambda&gt; * EQ() + EQ() * Exp())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="mi">2</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span>
<span class="go">GP(2, 2 * EQ())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="mi">0</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span>
<span class="go">GP(0, 0)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span>
<span class="go">GP(0, &lt;lambda&gt; * EQ())</span>
</pre></div>
</div>
</li>
<li><p>Shift GPs.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">GP(0, EQ() shift 1)</span>
</pre></div>
</div>
</li>
<li><p>Stretch GPs.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">GP(0, EQ() &gt; 2)</span>
</pre></div>
</div>
</li>
<li><p>Select particular input dimensions.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">GP(0, EQ() : [1, 3])</span>
</pre></div>
</div>
</li>
<li><p>Transform the input.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">GP(0, EQ() transform f)</span>
</pre></div>
</div>
</li>
<li><p>Numerically take the derivative of a GP. The argument specifies which
dimension to take the derivative with respect to.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">GP(0, d(1) EQ())</span>
</pre></div>
</div>
</li>
<li><p>Construct a finite difference estimate of the derivative of a GP. See
<code class="docutils literal notranslate"><span class="pre">Measure.diff_approx</span></code> for a description of the arguments.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">diff_approx</span><span class="p">(</span><span class="n">deriv</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">GP(50000000.0 * (0.5 * EQ() + 0.5 * ((-0.5 * (EQ() shift (0.0001414213562373095, 0))) shift (0, -0.0001414213562373095)) + 0.5 * ((-0.5 * (EQ() shift (0, 0.0001414213562373095))) shift (-0.0001414213562373095, 0))), 0)</span>
</pre></div>
</div>
</li>
<li><p>Construct the Cartesian product of a collection of GPs.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prior</span> <span class="o">=</span> <span class="n">Measure</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">),</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cross</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">)</span>
<span class="go">GP(MultiOutputMean(0, 0), MultiOutputKernel(EQ(), EQ()))</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="displaying-gps">
<h4>Displaying GPs<a class="headerlink" href="#displaying-gps" title="Permalink to this headline">¶</a></h4>
<p>Like means and kernels, GPs have a <code class="docutils literal notranslate"><span class="pre">display</span></code> method that accepts a
formatter.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">GP</span><span class="p">(</span><span class="mf">2.12345</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<span class="go">GP(2.12 * EQ(), 0)</span>
</pre></div>
</div>
</div>
<div class="section" id="properties-of-gps">
<h4>Properties of GPs<a class="headerlink" href="#properties-of-gps" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://github.com/wesselb/mlkernels#properties-of-kernels-and-means">Properties of
kernels</a>
can be queried on GPs directly.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">stationary</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
<div class="section" id="naming-gps">
<h4>Naming GPs<a class="headerlink" href="#naming-gps" title="Permalink to this headline">¶</a></h4>
<p>It is possible to give a name to a GP. Names must be strings. A measure
then behaves like a two-way dictionary between GPs and their names.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prior</span> <span class="o">=</span> <span class="n">Measure</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;name&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alternative_name&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;alternative_name&#39;</span><span class="p">]</span>
<span class="go">GP(0, EQ())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">prior</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
<span class="go">&#39;alternative_name&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="finite-dimensional-distributions">
<h3>Finite-Dimensional Distributions<a class="headerlink" href="#finite-dimensional-distributions" title="Permalink to this headline">¶</a></h3>
<p>Simply call a GP to construct a finite-dimensional distribution at some
inputs. You can give a second argument, which specifies the variance of
additional additive noise. After constructing a finite-dimensional
distribution, you can compute the mean, the variance, sample, or compute
a logpdf.</p>
<p>Definition, where <code class="docutils literal notranslate"><span class="pre">f</span></code> is a <code class="docutils literal notranslate"><span class="pre">GP</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>         <span class="c1"># No additional noise</span>

<span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">noise</span><span class="p">)</span>  <span class="c1"># Additional noise with variance `noise`</span>
</pre></div>
</div>
<p>Things you can do with a finite-dimensional distribution:</p>
<ul>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">f(x).mean</span></code> to compute the mean.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">f(x).var</span></code> to compute the variance.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">Normal.sample</span></code> to sample.</p>
<p>Definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>                <span class="c1"># Produce one sample.</span>

<span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>               <span class="c1"># Produce `n` samples.</span>

<span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">)</span>     <span class="c1"># Produce one samples with additional noise variance `noise`.</span>

<span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="n">noise</span><span class="p">)</span>  <span class="c1"># Produce `n` samples with additional noise variance `noise`.</span>
</pre></div>
</div>
</li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">f(x).logpdf(y)</span></code> to compute the logpdf of some data <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">means,</span> <span class="pre">variances</span> <span class="pre">=</span> <span class="pre">f(x).marginals()</span></code> to efficiently compute
the marginal means and marginal variances.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>
<span class="go">(array([0., 0., 0.]), np.array([1., 1., 1.]))</span>
</pre></div>
</div>
</li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">means,</span> <span class="pre">lowers,</span> <span class="pre">uppers</span> <span class="pre">=</span> <span class="pre">f(x).marginal_credible_bounds()</span></code> to
efficiently compute the means and the marginal lower and upper 95%
central credible region bounds.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>
<span class="go">(array([0., 0., 0.]), array([-1.96, -1.96, -1.96]), array([1.96, 1.96, 1.96]))</span>
</pre></div>
</div>
</li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">Measure.logpdf</span></code> to compute the joint logpdf of multiple
observations.</p>
<p>Definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prior</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>

<span class="n">prior</span><span class="o">.</span><span class="n">logpdf</span><span class="p">((</span><span class="n">f1</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">y2</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">Measure.sample</span></code> to jointly sample multiple observations.</p>
<p>Definition, where <code class="docutils literal notranslate"><span class="pre">prior</span> <span class="pre">=</span> <span class="pre">Measure()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="n">sample1</span><span class="p">,</span> <span class="n">sample2</span><span class="p">,</span> <span class="o">...</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">f2</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prior</span> <span class="o">=</span> <span class="n">Measure</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>       <span class="c1"># FDD without noise.</span>
<span class="go">&lt;FDD:</span>
<span class="go"> process=GP(0, EQ()),</span>
<span class="go"> input=array([0., 1., 2.]),</span>
<span class="go"> noise=&lt;zero matrix: shape=3x3, dtype=float64&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># FDD with noise.</span>
<span class="go">&lt;FDD:</span>
<span class="go"> process=GP(0, EQ()),</span>
<span class="go"> input=array([0., 1., 2.]),</span>
<span class="go"> noise=&lt;diagonal matrix: shape=3x3, dtype=float64</span>
<span class="go">        diag=[0.1 0.1 0.1]&gt;&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span>
<span class="go">array([[0.],</span>
<span class="go">       [0.],</span>
<span class="go">       [0.]])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">var</span>
<span class="go">&lt;dense matrix: shape=3x3, dtype=float64</span>
<span class="go"> mat=[[1.    0.607 0.135]</span>
<span class="go">      [0.607 1.    0.607]</span>
<span class="go">      [0.135 0.607 1.   ]]&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">y1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">y1</span>
<span class="go">array([[-0.45172746],</span>
<span class="go">       [ 0.46581948],</span>
<span class="go">       [ 0.78929767]])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="go">-2.811609567720761</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">y2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">array([[-0.43771276, -2.36741858],</span>
<span class="go">       [ 0.86080043, -1.22503079],</span>
<span class="go">       [ 2.15779126, -0.75319405]]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
<span class="go"> array([-4.82949038, -5.40084225])</span>
</pre></div>
</div>
</div>
<div class="section" id="prior-and-posterior-measures">
<h3>Prior and Posterior Measures<a class="headerlink" href="#prior-and-posterior-measures" title="Permalink to this headline">¶</a></h3>
<p>Conditioning a <em>prior</em> measure on observations gives a <em>posterior</em>
measure. To condition a measure on observations, use <code class="docutils literal notranslate"><span class="pre">Measure.__or__</span></code>.</p>
<p>Definition, where <code class="docutils literal notranslate"><span class="pre">prior</span> <span class="pre">=</span> <span class="pre">Measure()</span></code> and <code class="docutils literal notranslate"><span class="pre">f*</span></code> are <code class="docutils literal notranslate"><span class="pre">GP</span></code>s:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">post</span> <span class="o">=</span> <span class="n">prior</span> <span class="o">|</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">noise</span><span class="p">]),</span> <span class="n">y</span><span class="p">)</span>

<span class="n">post</span> <span class="o">=</span> <span class="n">prior</span> <span class="o">|</span> <span class="p">((</span><span class="n">f1</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="p">[</span><span class="n">noise1</span><span class="p">]),</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="p">[</span><span class="n">noise2</span><span class="p">]),</span> <span class="n">y2</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>You can then obtain a posterior process with <code class="docutils literal notranslate"><span class="pre">post(f)</span></code> and a
finite-dimensional distribution under the posterior with <code class="docutils literal notranslate"><span class="pre">post(f(x))</span></code>.
Alternatively, the posterior of a process <code class="docutils literal notranslate"><span class="pre">f</span></code> can be obtained by
conditioning <code class="docutils literal notranslate"><span class="pre">f</span></code> directly.</p>
<p>Definition, where and <code class="docutils literal notranslate"><span class="pre">f*</span></code> are <code class="docutils literal notranslate"><span class="pre">GP</span></code>s:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f_post</span> <span class="o">=</span> <span class="n">f</span> <span class="o">|</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">noise</span><span class="p">]),</span> <span class="n">y</span><span class="p">)</span>

<span class="n">f_post</span> <span class="o">=</span> <span class="n">f</span> <span class="o">|</span> <span class="p">((</span><span class="n">f1</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="p">[</span><span class="n">noise1</span><span class="p">]),</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="p">[</span><span class="n">noise2</span><span class="p">]),</span> <span class="n">y2</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s consider an example. First, build a model and sample some values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prior</span> <span class="o">=</span> <span class="n">Measure</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</pre></div>
</div>
<p>Then compute the posterior measure.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">post</span> <span class="o">=</span> <span class="n">prior</span> <span class="o">|</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">post</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">GP(PosteriorMean(), PosteriorKernel())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">post</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;dense matrix: shape=3x1, dtype=float64</span>
<span class="go"> mat=[[ 0.412]</span>
<span class="go">      [-0.811]</span>
<span class="go">      [-0.933]]&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">post</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;dense matrix: shape=3x3, dtype=float64</span>
<span class="go"> mat=[[1.e-12 0.e+00 0.e+00]</span>
<span class="go">      [0.e+00 1.e-12 0.e+00]</span>
<span class="go">      [0.e+00 0.e+00 1.e-12]]&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">post</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="go">&lt;FDD:</span>
<span class="go"> process=GP(PosteriorMean(), PosteriorKernel()),</span>
<span class="go"> input=array([0., 1., 2.]),</span>
<span class="go"> noise=&lt;zero matrix: shape=3x3, dtype=float64&gt;&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">post</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span>
<span class="go">&lt;dense matrix: shape=3x1, dtype=float64</span>
<span class="go"> mat=[[ 0.412]</span>
<span class="go">      [-0.811]</span>
<span class="go">      [-0.933]]&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">post</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">var</span>
<span class="go">&lt;dense matrix: shape=3x3, dtype=float64</span>
<span class="go"> mat=[[1.e-12 0.e+00 0.e+00]</span>
<span class="go">      [0.e+00 1.e-12 0.e+00]</span>
<span class="go">      [0.e+00 0.e+00 1.e-12]]&gt;</span>
</pre></div>
</div>
<p>We can also obtain the posterior by conditioning <code class="docutils literal notranslate"><span class="pre">f</span></code> directly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f_post</span> <span class="o">=</span> <span class="n">f</span> <span class="o">|</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_post</span>
<span class="go">GP(PosteriorMean(), PosteriorKernel())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_post</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;dense matrix: shape=3x1, dtype=float64</span>
<span class="go"> mat=[[ 0.412]</span>
<span class="go">      [-0.811]</span>
<span class="go">      [-0.933]]&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_post</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;dense matrix: shape=3x3, dtype=float64</span>
<span class="go"> mat=[[1.e-12 0.e+00 0.e+00]</span>
<span class="go">      [0.e+00 1.e-12 0.e+00]</span>
<span class="go">      [0.e+00 0.e+00 1.e-12]]&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_post</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;FDD:</span>
<span class="go"> process=GP(PosteriorMean(), PosteriorKernel()),</span>
<span class="go"> input=array([0., 1., 2.]),</span>
<span class="go"> noise=&lt;zero matrix: shape=3x3, dtype=float64&gt;&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_post</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span>
<span class="go">&lt;dense matrix: shape=3x1, dtype=float64</span>
<span class="go"> mat=[[ 0.412]</span>
<span class="go">      [-0.811]</span>
<span class="go">      [-0.933]]&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_post</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">var</span>
<span class="go">&lt;dense matrix: shape=3x3, dtype=float64</span>
<span class="go"> mat=[[1.e-12 0.e+00 0.e+00]</span>
<span class="go">      [0.e+00 1.e-12 0.e+00]</span>
<span class="go">      [0.e+00 0.e+00 1.e-12]]&gt;</span>
</pre></div>
</div>
<p>We can further extend our model by building on the posterior.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">Linear</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">post</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_sum</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="n">g</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_sum</span>
<span class="go">GP(PosteriorMean(), PosteriorKernel() + Linear())</span>
</pre></div>
</div>
<p>However, what we cannot do is mixing the prior and posterior.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">+</span> <span class="n">g</span>
<span class="go">AssertionError: Processes GP(0, EQ()) and GP(0, Linear()) are associated to different measures.</span>
</pre></div>
</div>
</div>
<div class="section" id="inducing-points">
<h3>Inducing Points<a class="headerlink" href="#inducing-points" title="Permalink to this headline">¶</a></h3>
<p>Stheno supports pseudo-point approximations of posterior distributions.
To construct a pseudo-point approximation, use <code class="docutils literal notranslate"><span class="pre">PseudoObs</span></code>.</p>
<p>Definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">obs</span> <span class="o">=</span> <span class="n">PseudoObs</span><span class="p">(</span>
    <span class="n">u</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>               <span class="c1"># FDD of inducing points</span>
    <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">noise</span><span class="p">]),</span> <span class="n">y</span><span class="p">)</span>  <span class="c1"># Observed data</span>
<span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">PseudoObs</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">noise</span><span class="p">]),</span> <span class="n">y</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">PseudoObs</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="p">[</span><span class="n">noise1</span><span class="p">]),</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="p">[</span><span class="n">noise2</span><span class="p">]),</span> <span class="n">y2</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">PseudoObs</span><span class="p">((</span><span class="n">u1</span><span class="p">(</span><span class="n">z1</span><span class="p">),</span> <span class="n">u2</span><span class="p">(</span><span class="n">z2</span><span class="p">),</span> <span class="o">...</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">noise</span><span class="p">]),</span> <span class="n">y</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">PseudoObs</span><span class="p">((</span><span class="n">u1</span><span class="p">(</span><span class="n">z1</span><span class="p">),</span> <span class="n">u2</span><span class="p">(</span><span class="n">z2</span><span class="p">),</span> <span class="o">...</span><span class="p">),</span> <span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="p">[</span><span class="n">noise1</span><span class="p">]),</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="p">[</span><span class="n">noise2</span><span class="p">]),</span> <span class="n">y2</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>The approximate posterior measure can be constructed with
<code class="docutils literal notranslate"><span class="pre">prior</span> <span class="pre">|</span> <span class="pre">obs</span></code> where <code class="docutils literal notranslate"><span class="pre">prior</span> <span class="pre">=</span> <span class="pre">Measure()</span></code> is the measure of your
model. To quantify the quality of the approximation, you can compute the
ELBO with <code class="docutils literal notranslate"><span class="pre">obs.elbo(prior)</span></code>.</p>
<p>Let’s consider an example. First, build a model and sample some noisy
observations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">prior</span> <span class="o">=</span> <span class="n">Measure</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">measure</span><span class="o">=</span><span class="n">prior</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">y_obs</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</pre></div>
</div>
<p>Ouch, computing the logpdf is quite slow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="o">%</span><span class="n">timeit</span> <span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>
<span class="go">219 ms ± 35.7 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</pre></div>
</div>
<p>Let’s try to use inducing points to speed this up.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_ind</span><span class="p">)</span>   <span class="c1"># FDD of inducing points.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="o">%</span><span class="n">timeit</span> <span class="n">PseudoObs</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span><span class="o">.</span><span class="n">elbo</span><span class="p">(</span><span class="n">prior</span><span class="p">)</span>
<span class="go">9.8 ms ± 181 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)</span>
</pre></div>
</div>
<p>Much better. And the approximation is good:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">PseudoObs</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span><span class="o">.</span><span class="n">elbo</span><span class="p">(</span><span class="n">prior</span><span class="p">)</span> <span class="o">-</span> <span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>
<span class="go">-3.537934389896691e-10</span>
</pre></div>
</div>
<p>We finally construct the approximate posterior measure:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">post_approx</span> <span class="o">=</span> <span class="n">prior</span> <span class="o">|</span> <span class="n">PseudoObs</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">post_approx</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span>
<span class="go">&lt;dense matrix: shape=2000x1, dtype=float64</span>
<span class="go"> mat=[[0.469]</span>
<span class="go">      [0.468]</span>
<span class="go">      [0.467]</span>
<span class="go">      ...</span>
<span class="go">      [1.09 ]</span>
<span class="go">      [1.09 ]</span>
<span class="go">      [1.091]]&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="kernels-and-means">
<h3>Kernels and Means<a class="headerlink" href="#kernels-and-means" title="Permalink to this headline">¶</a></h3>
<p>See <a class="reference external" href="https://github.com/wesselb/mlkernels">MLKernels</a>.</p>
</div>
<div class="section" id="important-remarks">
<h3>Important Remarks<a class="headerlink" href="#important-remarks" title="Permalink to this headline">¶</a></h3>
<p>Stheno uses <a class="reference external" href="https://github.com/wesselb/lab">LAB</a> to provide an
implementation that is backend agnostic. Moreover, Stheno uses <a class="reference external" href="https://github.com/wesselb/matrix">an
extension of LAB</a> to accelerate
linear algebra with structured linear algebra primitives. You will
encounter these primitives:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">k</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Delta</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">&lt;diagonal matrix: shape=10x10, dtype=float64</span>
<span class="go"> diag=[2. 2. 2. 2. 2. 2. 2. 2. 2. 2.]&gt;</span>
</pre></div>
</div>
<p>If you’re using <a class="reference external" href="https://github.com/wesselb/lab">LAB</a> to further
process these matrices, then there is absolutely no need to worry: these
structured matrix types know how to add, multiply, and do other linear
algebra operations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">lab</span> <span class="k">as</span> <span class="nn">B</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="go">&lt;diagonal matrix: shape=10x10, dtype=float64</span>
<span class="go"> diag=[4. 4. 4. 4. 4. 4. 4. 4. 4. 4.]&gt;</span>
</pre></div>
</div>
<p>If you’re not using <a class="reference external" href="https://github.com/wesselb/lab">LAB</a>, you can
convert these structured primitives to regular
NumPy/TensorFlow/PyTorch/JAX arrays by calling <code class="docutils literal notranslate"><span class="pre">B.dense</span></code> (<code class="docutils literal notranslate"><span class="pre">B</span></code> is
from <a class="reference external" href="https://github.com/wesselb/lab">LAB</a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">lab</span> <span class="k">as</span> <span class="nn">B</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="go">array([[2., 0., 0., 0., 0., 0., 0., 0., 0., 0.],</span>
<span class="go">       [0., 2., 0., 0., 0., 0., 0., 0., 0., 0.],</span>
<span class="go">       [0., 0., 2., 0., 0., 0., 0., 0., 0., 0.],</span>
<span class="go">       [0., 0., 0., 2., 0., 0., 0., 0., 0., 0.],</span>
<span class="go">       [0., 0., 0., 0., 2., 0., 0., 0., 0., 0.],</span>
<span class="go">       [0., 0., 0., 0., 0., 2., 0., 0., 0., 0.],</span>
<span class="go">       [0., 0., 0., 0., 0., 0., 2., 0., 0., 0.],</span>
<span class="go">       [0., 0., 0., 0., 0., 0., 0., 2., 0., 0.],</span>
<span class="go">       [0., 0., 0., 0., 0., 0., 0., 0., 2., 0.],</span>
<span class="go">       [0., 0., 0., 0., 0., 0., 0., 0., 0., 2.]])</span>
</pre></div>
</div>
<p>Furthermore, before computing a Cholesky decomposition, Stheno always
adds a minuscule diagonal to prevent the Cholesky decomposition from
failing due to positive indefiniteness caused by numerical noise. You
can change the magnitude of this diagonal by changing <code class="docutils literal notranslate"><span class="pre">B.epsilon</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">lab</span> <span class="k">as</span> <span class="nn">B</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-12</span>   <span class="c1"># Default regularisation</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">B</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-8</span>    <span class="c1"># Strong regularisation</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>The examples make use of <a class="reference external" href="https://github.com/wesselb/varz">Varz</a> and
some utility from <a class="reference external" href="https://github.com/wesselb/wbml">WBML</a>.</p>
<div class="section" id="simple-regression">
<h3>Simple Regression<a class="headerlink" href="#simple-regression" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id1">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_example1_simple_regression.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">wbml.plot</span> <span class="kn">import</span> <span class="n">tweak</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">B</span><span class="p">,</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="c1"># Construct a prior.</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">periodic</span><span class="p">(</span><span class="mf">5.0</span><span class="p">))</span>

<span class="c1"># Sample a true, underlying function and noisy observations.</span>
<span class="n">f_true</span><span class="p">,</span> <span class="n">y_obs</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

<span class="c1"># Now condition on the observations to make predictions.</span>
<span class="n">f_post</span> <span class="o">=</span> <span class="n">f</span> <span class="o">|</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">f_post</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>

<span class="c1"># Plot result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">tweak</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;readme_example1_simple_regression.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="decomposition-of-prediction">
<h3>Decomposition of Prediction<a class="headerlink" href="#decomposition-of-prediction" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id2">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_example2_decomposition.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">wbml.plot</span> <span class="kn">import</span> <span class="n">tweak</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">RQ</span><span class="p">,</span> <span class="n">Linear</span><span class="p">,</span> <span class="n">Delta</span><span class="p">,</span> <span class="n">Exp</span><span class="p">,</span> <span class="n">B</span>

<span class="n">B</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-10</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>


<span class="k">with</span> <span class="n">Measure</span><span class="p">()</span> <span class="k">as</span> <span class="n">prior</span><span class="p">:</span>
    <span class="c1"># Construct a latent function consisting of four different components.</span>
    <span class="n">f_smooth</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span>
    <span class="n">f_wiggly</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">RQ</span><span class="p">(</span><span class="mf">1e-1</span><span class="p">)</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
    <span class="n">f_periodic</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">periodic</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>
    <span class="n">f_linear</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">Linear</span><span class="p">())</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">f_smooth</span> <span class="o">+</span> <span class="n">f_wiggly</span> <span class="o">+</span> <span class="n">f_periodic</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">f_linear</span>

    <span class="c1"># Let the observation noise consist of a bit of exponential noise.</span>
    <span class="n">e_indep</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">Delta</span><span class="p">())</span>
    <span class="n">e_exp</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">Exp</span><span class="p">())</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">e_indep</span> <span class="o">+</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">e_exp</span>

    <span class="c1"># Sum the latent function and observation noise to get a model for the observations.</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">f</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">e</span>

<span class="c1"># Sample a true, underlying function and observations.</span>
<span class="p">(</span>
    <span class="n">f_true_smooth</span><span class="p">,</span>
    <span class="n">f_true_wiggly</span><span class="p">,</span>
    <span class="n">f_true_periodic</span><span class="p">,</span>
    <span class="n">f_true_linear</span><span class="p">,</span>
    <span class="n">f_true</span><span class="p">,</span>
    <span class="n">y_obs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">f_smooth</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f_wiggly</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f_periodic</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f_linear</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">x_obs</span><span class="p">))</span>

<span class="c1"># Now condition on the observations and make predictions for the latent function and</span>
<span class="c1"># its various components.</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">prior</span> <span class="o">|</span> <span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x_obs</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>

<span class="n">pred_smooth</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">f_smooth</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">pred_wiggly</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">f_wiggly</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">pred_periodic</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">f_periodic</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">pred_linear</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">f_linear</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">pred_f</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>


<span class="c1"># Plot results.</span>
<span class="k">def</span> <span class="nf">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">x_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x_obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
    <span class="n">tweak</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Prediction&quot;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">pred_f</span><span class="p">,</span> <span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Smooth Component&quot;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true_smooth</span><span class="p">,</span> <span class="n">pred_smooth</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Wiggly Component&quot;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true_wiggly</span><span class="p">,</span> <span class="n">pred_wiggly</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Periodic Component&quot;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true_periodic</span><span class="p">,</span> <span class="n">pred_periodic</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Linear Component&quot;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true_linear</span><span class="p">,</span> <span class="n">pred_linear</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;readme_example2_decomposition.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="learn-a-function-incorporating-prior-knowledge-about-its-form">
<h3>Learn a Function, Incorporating Prior Knowledge About Its Form<a class="headerlink" href="#learn-a-function-incorporating-prior-knowledge-about-its-form" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id3">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_example3_parametric.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">wbml.out</span> <span class="k">as</span> <span class="nn">out</span>
<span class="kn">from</span> <span class="nn">varz.spec</span> <span class="kn">import</span> <span class="n">parametrised</span><span class="p">,</span> <span class="n">Positive</span>
<span class="kn">from</span> <span class="nn">varz.tensorflow</span> <span class="kn">import</span> <span class="n">Vars</span><span class="p">,</span> <span class="n">minimise_l_bfgs_b</span>
<span class="kn">from</span> <span class="nn">wbml.plot</span> <span class="kn">import</span> <span class="n">tweak</span>

<span class="kn">from</span> <span class="nn">stheno.tensorflow</span> <span class="kn">import</span> <span class="n">B</span><span class="p">,</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">Delta</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>


<span class="nd">@parametrised</span>
<span class="k">def</span> <span class="nf">model</span><span class="p">(</span>
    <span class="n">vs</span><span class="p">,</span>
    <span class="n">u_var</span><span class="p">:</span> <span class="n">Positive</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">u_scale</span><span class="p">:</span> <span class="n">Positive</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">noise</span><span class="p">:</span> <span class="n">Positive</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="n">Positive</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">with</span> <span class="n">Measure</span><span class="p">():</span>
        <span class="c1"># Random fluctuation:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">u_var</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="n">u_scale</span><span class="p">))</span>
        <span class="c1"># Construct model.</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="n">alpha</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">noise</span>


<span class="c1"># Sample a true, underlying function and observations.</span>
<span class="n">vs</span> <span class="o">=</span> <span class="n">Vars</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">f_true</span> <span class="o">=</span> <span class="n">x</span> <span class="o">**</span> <span class="mf">1.8</span> <span class="o">+</span> <span class="n">B</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">measure</span> <span class="o">|</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f_true</span><span class="p">)</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">vs</span><span class="p">):</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span>
    <span class="n">evidence</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">noise</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">evidence</span>


<span class="c1"># Learn hyperparameters.</span>
<span class="n">minimise_l_bfgs_b</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">noise</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span>

<span class="c1"># Print the learned parameters.</span>
<span class="n">out</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="s2">&quot;Prior&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">format</span><span class="p">))</span>
<span class="n">vs</span><span class="o">.</span><span class="n">print</span><span class="p">()</span>

<span class="c1"># Condition on the observations to make predictions.</span>
<span class="n">f_post</span> <span class="o">=</span> <span class="n">f</span> <span class="o">|</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">noise</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">f_post</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>

<span class="c1"># Plot result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f_true</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y_obs</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">tweak</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;readme_example3_parametric.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="multi-output-regression">
<h3>Multi-Output Regression<a class="headerlink" href="#multi-output-regression" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id4">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_example4_multi-output.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">wbml.plot</span> <span class="kn">import</span> <span class="n">tweak</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">B</span><span class="p">,</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">Delta</span>


<span class="k">class</span> <span class="nc">VGP</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A vector-valued GP.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ps</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ps</span> <span class="o">=</span> <span class="n">ps</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">VGP</span><span class="p">([</span><span class="n">f</span> <span class="o">+</span> <span class="n">g</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">ps</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">lmatmul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">ps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">VGP</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>


<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1"># Model parameters:</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>


<span class="k">with</span> <span class="n">Measure</span><span class="p">()</span> <span class="k">as</span> <span class="n">prior</span><span class="p">:</span>
    <span class="c1"># Construct latent functions.</span>
    <span class="n">us</span> <span class="o">=</span> <span class="n">VGP</span><span class="p">([</span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)])</span>

    <span class="c1"># Construct multi-output prior.</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">us</span><span class="o">.</span><span class="n">lmatmul</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>

    <span class="c1"># Construct noise.</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">VGP</span><span class="p">([</span><span class="n">GP</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">Delta</span><span class="p">())</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">)])</span>

    <span class="c1"># Construct observation model.</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">e</span> <span class="o">+</span> <span class="n">fs</span>

<span class="c1"># Sample a true, underlying function and observations.</span>
<span class="n">samples</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">fs</span><span class="o">.</span><span class="n">ps</span><span class="p">),</span> <span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">x_obs</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ys</span><span class="o">.</span><span class="n">ps</span><span class="p">))</span>
<span class="n">fs_true</span><span class="p">,</span> <span class="n">ys_obs</span> <span class="o">=</span> <span class="n">samples</span><span class="p">[:</span><span class="n">p</span><span class="p">],</span> <span class="n">samples</span><span class="p">[</span><span class="n">p</span><span class="p">:]</span>

<span class="c1"># Compute the posterior and make predictions.</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="n">p</span><span class="p">(</span><span class="n">x_obs</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">y_obs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ys</span><span class="o">.</span><span class="n">ps</span><span class="p">,</span> <span class="n">ys_obs</span><span class="p">)))</span>
<span class="n">preds</span> <span class="o">=</span> <span class="p">[</span><span class="n">post</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">fs</span><span class="o">.</span><span class="n">ps</span><span class="p">]</span>


<span class="c1"># Plot results.</span>
<span class="k">def</span> <span class="nf">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">x_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x_obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
    <span class="n">tweak</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output </span><span class="si">{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fs_true</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">preds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_obs</span><span class="p">,</span> <span class="n">ys_obs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;readme_example4_multi-output.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="approximate-integration">
<h3>Approximate Integration<a class="headerlink" href="#approximate-integration" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id5">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_example5_integration.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">wbml.plot</span>

<span class="kn">from</span> <span class="nn">stheno.tensorflow</span> <span class="kn">import</span> <span class="n">B</span><span class="p">,</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">Delta</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Measure</span><span class="p">()</span> <span class="k">as</span> <span class="n">prior</span><span class="p">:</span>
    <span class="c1"># Construct a model.</span>
    <span class="n">f</span> <span class="o">=</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">Delta</span><span class="p">())</span>

    <span class="c1"># Construct derivatives.</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
    <span class="n">ddf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
    <span class="n">dddf</span> <span class="o">=</span> <span class="n">ddf</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">+</span> <span class="n">e</span>

<span class="c1"># Fix the integration constants.</span>
<span class="n">zero</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">one</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">prior</span> <span class="o">=</span> <span class="n">prior</span> <span class="o">|</span> <span class="p">((</span><span class="n">f</span><span class="p">(</span><span class="n">zero</span><span class="p">),</span> <span class="n">one</span><span class="p">),</span> <span class="p">(</span><span class="n">df</span><span class="p">(</span><span class="n">zero</span><span class="p">),</span> <span class="n">zero</span><span class="p">),</span> <span class="p">(</span><span class="n">ddf</span><span class="p">(</span><span class="n">zero</span><span class="p">),</span> <span class="o">-</span><span class="n">one</span><span class="p">))</span>

<span class="c1"># Sample observations.</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_obs</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">x_obs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Condition on the observations to make predictions.</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">prior</span> <span class="o">|</span> <span class="p">(</span><span class="n">dddf</span><span class="p">(</span><span class="n">x_obs</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>

<span class="c1"># And make predictions.</span>
<span class="n">pred_iiif</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="n">pred_iif</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">df</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="n">pred_if</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">ddf</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="n">pred_f</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">dddf</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>


<span class="c1"># Plot result.</span>
<span class="k">def</span> <span class="nf">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">x_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_obs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x_obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
    <span class="n">wbml</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">tweak</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Function&quot;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">pred_f</span><span class="p">,</span> <span class="n">x_obs</span><span class="o">=</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="o">=</span><span class="n">y_obs</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Integral of Function&quot;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">pred_if</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Second Integral of Function&quot;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">pred_iif</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Third Integral of Function&quot;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">pred_iiif</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;readme_example5_integration.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="bayesian-linear-regression">
<h3>Bayesian Linear Regression<a class="headerlink" href="#bayesian-linear-regression" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id6">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_example6_blr.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">wbml.out</span> <span class="k">as</span> <span class="nn">out</span>
<span class="kn">from</span> <span class="nn">wbml.plot</span> <span class="kn">import</span> <span class="n">tweak</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">B</span><span class="p">,</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">GP</span>

<span class="n">B</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-10</span>  <span class="c1"># Very slightly regularise.</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Measure</span><span class="p">()</span> <span class="k">as</span> <span class="n">prior</span><span class="p">:</span>
    <span class="c1"># Construct a linear model.</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">intercept</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">slope</span> <span class="o">*</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">intercept</span>

<span class="c1"># Sample a slope, intercept, underlying function, and observations.</span>
<span class="n">true_slope</span><span class="p">,</span> <span class="n">true_intercept</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">y_obs</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
    <span class="n">slope</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">intercept</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Condition on the observations to make predictions.</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">prior</span> <span class="o">|</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>

<span class="n">out</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="s2">&quot;True slope&quot;</span><span class="p">,</span> <span class="n">true_slope</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">out</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="s2">&quot;Predicted slope&quot;</span><span class="p">,</span> <span class="n">post</span><span class="p">(</span><span class="n">slope</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">out</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="s2">&quot;True intercept&quot;</span><span class="p">,</span> <span class="n">true_intercept</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">out</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="s2">&quot;Predicted intercept&quot;</span><span class="p">,</span> <span class="n">post</span><span class="p">(</span><span class="n">intercept</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># Plot result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">tweak</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;readme_example6_blr.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="gpar">
<h3>GPAR<a class="headerlink" href="#gpar" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id7">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_example7_gpar.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">varz.spec</span> <span class="kn">import</span> <span class="n">parametrised</span><span class="p">,</span> <span class="n">Positive</span>
<span class="kn">from</span> <span class="nn">varz.tensorflow</span> <span class="kn">import</span> <span class="n">Vars</span><span class="p">,</span> <span class="n">minimise_l_bfgs_b</span>
<span class="kn">from</span> <span class="nn">wbml.plot</span> <span class="kn">import</span> <span class="n">tweak</span>

<span class="kn">from</span> <span class="nn">stheno.tensorflow</span> <span class="kn">import</span> <span class="n">B</span><span class="p">,</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">x_obs1</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">inds2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_obs1</span><span class="p">))[:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">x_obs2</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">x_obs1</span><span class="p">,</span> <span class="n">inds2</span><span class="p">)</span>

<span class="c1"># Construction functions to predict and observations.</span>
<span class="n">f1_true</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">f2_true</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

<span class="n">y1_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_obs1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">x_obs1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">y2_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_obs2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">x_obs2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>


<span class="nd">@parametrised</span>
<span class="k">def</span> <span class="nf">model</span><span class="p">(</span>
    <span class="n">vs</span><span class="p">,</span>
    <span class="n">var1</span><span class="p">:</span> <span class="n">Positive</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">scale1</span><span class="p">:</span> <span class="n">Positive</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">noise1</span><span class="p">:</span> <span class="n">Positive</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">var2</span><span class="p">:</span> <span class="n">Positive</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">scale2</span><span class="p">:</span> <span class="n">Positive</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">noise2</span><span class="p">:</span> <span class="n">Positive</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
<span class="p">):</span>
    <span class="c1"># Build layers:</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">var1</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="n">scale1</span><span class="p">))</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">var2</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="n">scale2</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">noise1</span><span class="p">),</span> <span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">noise2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">vs</span><span class="p">):</span>
    <span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">noise1</span><span class="p">),</span> <span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">noise2</span><span class="p">)</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">x_obs1</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">x_obs2</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">y1_obs</span><span class="p">,</span> <span class="n">inds2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">evidence</span> <span class="o">=</span> <span class="n">f1</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">noise1</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y1_obs</span><span class="p">)</span> <span class="o">+</span> <span class="n">f2</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">noise2</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y2_obs</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">evidence</span>


<span class="c1"># Learn hyperparameters.</span>
<span class="n">vs</span> <span class="o">=</span> <span class="n">Vars</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">minimise_l_bfgs_b</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">vs</span><span class="p">)</span>

<span class="c1"># Compute posteriors.</span>
<span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">noise1</span><span class="p">),</span> <span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="n">noise2</span><span class="p">)</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">x_obs1</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">x_obs2</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">y1_obs</span><span class="p">,</span> <span class="n">inds2</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">f1_post</span> <span class="o">=</span> <span class="n">f1</span> <span class="o">|</span> <span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">noise1</span><span class="p">),</span> <span class="n">y1_obs</span><span class="p">)</span>
<span class="n">f2_post</span> <span class="o">=</span> <span class="n">f2</span> <span class="o">|</span> <span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">noise2</span><span class="p">),</span> <span class="n">y2_obs</span><span class="p">)</span>

<span class="c1"># Predict first output.</span>
<span class="n">mean1</span><span class="p">,</span> <span class="n">lower1</span><span class="p">,</span> <span class="n">upper1</span> <span class="o">=</span> <span class="n">f1_post</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>

<span class="c1"># Predict second output with Monte Carlo.</span>
<span class="n">samples</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">f2_post</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f1_post</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">()[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">mean2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">lower2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">upper2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plot result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Output 1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f1_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs1</span><span class="p">,</span> <span class="n">y1_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower1</span><span class="p">,</span> <span class="n">upper1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">tweak</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Output 2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f2_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs2</span><span class="p">,</span> <span class="n">y2_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower2</span><span class="p">,</span> <span class="n">upper2</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">tweak</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;readme_example7_gpar.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="a-gp-rnn-model">
<h3>A GP-RNN Model<a class="headerlink" href="#a-gp-rnn-model" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id8">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_example8_gp-rnn.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">varz.spec</span> <span class="kn">import</span> <span class="n">parametrised</span><span class="p">,</span> <span class="n">Positive</span>
<span class="kn">from</span> <span class="nn">varz.tensorflow</span> <span class="kn">import</span> <span class="n">Vars</span><span class="p">,</span> <span class="n">minimise_adam</span>
<span class="kn">from</span> <span class="nn">wbml.net</span> <span class="kn">import</span> <span class="n">rnn</span> <span class="k">as</span> <span class="n">rnn_constructor</span>
<span class="kn">from</span> <span class="nn">wbml.plot</span> <span class="kn">import</span> <span class="n">tweak</span>

<span class="kn">from</span> <span class="nn">stheno.tensorflow</span> <span class="kn">import</span> <span class="n">B</span><span class="p">,</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>

<span class="c1"># Increase regularisation because we are dealing with `tf.float32`s.</span>
<span class="n">B</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-6</span>

<span class="c1"># Construct points which to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">inds_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>  <span class="c1"># Train on the first 75% only.</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">inds_obs</span><span class="p">)</span>

<span class="c1"># Construct function and observations.</span>
<span class="c1">#   Draw random modulation functions.</span>
<span class="n">a_true</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="mf">1e-2</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<span class="n">b_true</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="mf">1e-2</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<span class="c1">#   Construct the true, underlying function.</span>
<span class="n">f_true</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a_true</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">7</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">b_true</span>
<span class="c1">#   Add noise.</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="n">f_true</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">f_true</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Normalise and split.</span>
<span class="n">f_true</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_true</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_true</span><span class="p">))</span> <span class="o">/</span> <span class="n">B</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">B</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_true</span><span class="p">))</span> <span class="o">/</span> <span class="n">B</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">inds_obs</span><span class="p">)</span>


<span class="nd">@parametrised</span>
<span class="k">def</span> <span class="nf">model</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="n">a_scale</span><span class="p">:</span> <span class="n">Positive</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">b_scale</span><span class="p">:</span> <span class="n">Positive</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">noise</span><span class="p">:</span> <span class="n">Positive</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">):</span>
    <span class="c1"># Construct an RNN.</span>
    <span class="n">f_rnn</span> <span class="o">=</span> <span class="n">rnn_constructor</span><span class="p">(</span>
        <span class="n">output_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">widths</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,),</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="n">B</span><span class="o">.</span><span class="n">tanh</span><span class="p">,</span> <span class="n">final_dense</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Set the weights for the RNN.</span>
    <span class="n">num_weights</span> <span class="o">=</span> <span class="n">f_rnn</span><span class="o">.</span><span class="n">num_weights</span><span class="p">(</span><span class="n">input_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">Vars</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">vs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_weights</span><span class="p">,),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rnn&quot;</span><span class="p">))</span>
    <span class="n">f_rnn</span><span class="o">.</span><span class="n">initialise</span><span class="p">(</span><span class="n">input_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vs</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">Measure</span><span class="p">():</span>
        <span class="c1"># Construct GPs that modulate the RNN.</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="mf">1e-2</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="n">a_scale</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="mf">1e-2</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="n">b_scale</span><span class="p">))</span>

        <span class="c1"># GP-RNN model:</span>
        <span class="n">f_gp_rnn</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">f_rnn</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="n">b</span>

    <span class="k">return</span> <span class="n">f_rnn</span><span class="p">,</span> <span class="n">f_gp_rnn</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>


<span class="k">def</span> <span class="nf">objective_rnn</span><span class="p">(</span><span class="n">vs</span><span class="p">):</span>
    <span class="n">f_rnn</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">B</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">f_rnn</span><span class="p">(</span><span class="n">x_obs</span><span class="p">)</span> <span class="o">-</span> <span class="n">y_obs</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">objective_gp_rnn</span><span class="p">(</span><span class="n">vs</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">f_gp_rnn</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span>
    <span class="n">evidence</span> <span class="o">=</span> <span class="n">f_gp_rnn</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">noise</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">evidence</span>


<span class="c1"># Pretrain the RNN.</span>
<span class="n">vs</span> <span class="o">=</span> <span class="n">Vars</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">minimise_adam</span><span class="p">(</span><span class="n">objective_rnn</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">5e-3</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Jointly train the RNN and GPs.</span>
<span class="n">minimise_adam</span><span class="p">(</span><span class="n">objective_gp_rnn</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">iters</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">jit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">_</span><span class="p">,</span> <span class="n">f_gp_rnn</span><span class="p">,</span> <span class="n">noise</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">vs</span><span class="p">)</span>

<span class="c1"># Condition.</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">f_gp_rnn</span><span class="o">.</span><span class="n">measure</span> <span class="o">|</span> <span class="p">(</span><span class="n">f_gp_rnn</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">noise</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>

<span class="c1"># Predict and plot results.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;$(1 + a)</span><span class="se">\\</span><span class="s2">cdot </span><span class="si">{}</span><span class="s2">$RNN$</span><span class="si">{}</span><span class="s2"> + b$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">f_gp_rnn</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">tweak</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;$a$&quot;</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">tweak</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;$b$&quot;</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">tweak</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;readme_example8_gp-rnn.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="approximate-multiplication-between-gps">
<h3>Approximate Multiplication Between GPs<a class="headerlink" href="#approximate-multiplication-between-gps" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id9">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_example9_product.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">wbml.plot</span> <span class="kn">import</span> <span class="n">tweak</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">B</span><span class="p">,</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Measure</span><span class="p">()</span> <span class="k">as</span> <span class="n">prior</span><span class="p">:</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">EQ</span><span class="p">())</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">EQ</span><span class="p">())</span>

    <span class="c1"># Compute the approximate product.</span>
    <span class="n">f_prod</span> <span class="o">=</span> <span class="n">f1</span> <span class="o">*</span> <span class="n">f2</span>

<span class="c1"># Sample two functions.</span>
<span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f2</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="c1"># Predict.</span>
<span class="n">f_prod_post</span> <span class="o">=</span> <span class="n">f_prod</span> <span class="o">|</span> <span class="p">((</span><span class="n">f1</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">s1</span><span class="p">),</span> <span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">s2</span><span class="p">))</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">f_prod_post</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>

<span class="c1"># Plot result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sample 1&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sample 2&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">s2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True product&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Approximate posterior&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">tweak</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;readme_example9_product.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="sparse-regression">
<h3>Sparse Regression<a class="headerlink" href="#sparse-regression" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id10">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_example10_sparse.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">wbml.out</span> <span class="k">as</span> <span class="nn">out</span>
<span class="kn">from</span> <span class="nn">wbml.plot</span> <span class="kn">import</span> <span class="n">tweak</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">B</span><span class="p">,</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">PseudoObs</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">50_000</span><span class="p">)</span>
<span class="n">x_ind</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="c1"># Construct a prior.</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">periodic</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>

<span class="c1"># Sample a true, underlying function and observations.</span>
<span class="n">f_true</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_obs</span><span class="p">)</span> <span class="o">+</span> <span class="n">B</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">x_obs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Compute a pseudo-point approximation of the posterior.</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">PseudoObs</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_ind</span><span class="p">),</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">))</span>

<span class="c1"># Compute the ELBO.</span>
<span class="n">out</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="s2">&quot;ELBO&quot;</span><span class="p">,</span> <span class="n">obs</span><span class="o">.</span><span class="n">elbo</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">measure</span><span class="p">))</span>

<span class="c1"># Compute the approximate posterior.</span>
<span class="n">f_post</span> <span class="o">=</span> <span class="n">f</span> <span class="o">|</span> <span class="n">obs</span>

<span class="c1"># Make predictions with the approximate posterior.</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">f_post</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>

<span class="c1"># Plot result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x_obs</span><span class="p">,</span>
    <span class="n">y_obs</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span>
    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="s2">&quot;tab:green&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x_ind</span><span class="p">,</span>
    <span class="n">obs</span><span class="o">.</span><span class="n">mu</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">measure</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Inducing Points&quot;</span><span class="p">,</span>
    <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">tweak</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;readme_example10_sparse.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="smoothing-with-nonparametric-basis-functions">
<h3>Smoothing with Nonparametric Basis Functions<a class="headerlink" href="#smoothing-with-nonparametric-basis-functions" title="Permalink to this headline">¶</a></h3>
<div class="figure align-default" id="id11">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_example11_nonparametric_basis.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">wbml.plot</span> <span class="kn">import</span> <span class="n">tweak</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">B</span><span class="p">,</span> <span class="n">Measure</span><span class="p">,</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Measure</span><span class="p">()</span> <span class="k">as</span> <span class="n">prior</span><span class="p">:</span>
    <span class="n">w</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">B</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Basis function</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">[(</span><span class="n">w</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">()))</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x_obs</span><span class="p">]</span>  <span class="c1"># Weighted basis functions</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="c1"># Sample a true, underlying function and observations.</span>
<span class="n">f_true</span><span class="p">,</span> <span class="n">y_obs</span> <span class="o">=</span> <span class="n">prior</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>

<span class="c1"># Condition on the observations to make predictions.</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">prior</span> <span class="o">|</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>

<span class="c1"># Plot result.</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">bi</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>
    <span class="n">kw_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Basis functions&quot;</span><span class="p">}</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred2&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_args</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Observations&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">post</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">marginal_credible_bounds</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;pred&quot;</span><span class="p">)</span>
<span class="n">tweak</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;readme_example11_nonparametric_basis.png&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="Application Programming Interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2017, Wessel Bruinsma

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>